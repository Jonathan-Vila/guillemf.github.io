
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>BDD - Mastermind : View Preparation - Guillem Fernandez</title>
  <meta name="author" content="Guillem Fernandez">

  
  <meta name="description" content="This is the fifth post to create an application using BDD and TDD in iOS. If you missed the previous post, my recommendation is that you read it &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.guillem.mobi/blog/2014/11/10/bdd-mastermind-view-preparation">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Guillem Fernandez" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52623021-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><img src="/images/Logo64.png" height="64" width="64"/ id="header-logo"><a href="/">Guillem Fernandez</a></h1>
  
    <h2>About my job and my passion.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
  
  
<ul class="subscription">
  <li><a href="http://delicious.com/guillemf" rel="subscribe-delicious" title="Delicious Bookmarks">Delicious</a></li>
</ul>
  
  
  
<ul class="subscription">
  <li><a href="https://github.com/guillemf" rel="subscribe-github" title="@guillemf on GitHub">GitHub</a></li>
</ul>
  
  
  
<ul class="subscription">
  <li><a href="https://bitbucket.org/guillemfg" rel="subscribe-bitbucket" title="@guillemfg on Bitbucket">Bitbucket</a></li>
</ul>
  
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.guillem.mobi" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/profile">About</a></li>
  <li><a href="/porfolio">Porfolio</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">BDD - Mastermind : View Preparation</h1>
      
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-10T13:25:00+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:25 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>This is the fifth post to create an application using BDD and TDD in iOS. If you missed the previous post, my recommendation is that you read it first <a href="/blog/2014/10/21/bdd-mastermind-view-preparation-to-make-the-ui-testable/" title="BDD - Mastermind : View preparation to make the UI testable">here</a>.</p>

<p>In the previous post I went through a way to test the visible result of the custom view in a very intuitive way. It was just an exercise to test how, in a simple way, we could have a complete test of how we expect our view looks like. The truth is that this is a feeble method as it depends on an image that might or might not be 100% achievable by the tools we can make use of.</p>

<p>The purpose of the previous post was to introduce the technique we are going to use in this post. We are going to go through a technique that allows us to test the final behavior in a more secure and maintainable way.</p>

<p>You can find the code corresponding to this post in <a href="https://github.com/guillemf/Mastermind-BDD/tree/Step_6" title="MasterMind-BDD Step6">this commit</a>. Go and get it!</p>

<!-- more -->


<h1>The result cells</h1>

<p><img class="left" src="https://farm3.staticflickr.com/2941/15101651020_46fb32d967_o.jpg" width="190" height="490" title="Mastermind Sketch With zones" alt="Mastermind board Sketch with zones"></p>

<p>The second element we have on the screen is the results cell. If you remember from the first post of the series, we defined three areas to consider. Area number three is a special kind of view that provides different visual aspects depending on the result we are providing. The rules are described in the second post of the series <a href="/blog/2014/09/25/bdd-mastermind-internal-design/" title="BDD - Mastermind : Internal design">BDD - Mastermind : Internal design</a>, but we need add a few more &ldquo;conditions&rdquo; to have a really robust view that does what we want it to do.</p>

<p><strong>First</strong> - We are only accepting two different symbols, no matter which symbols but just two different.<br>
<strong>Second</strong> - If the first symbol is a space, then it is considered there are no symbols of the first type and all the symbols are considered second kind.<br>
<strong>Third</strong> - As there is no specification, the circles will try to fill as much space as possible. One symbol will end in a single big circle.</p>

<p>With this in mind we have enough information to start creating the tests to implement the result cell.</p>

<h1>Test and implementation</h1>

<p>A very common practice is to create helper methods to simplify the test and provide more clarity. In this case we need to create a combination generator, so I implement this random combination generators.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// Helper Methods</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">generateRandomCharString</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Available symbols</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">symbols</span> <span class="o">=</span> <span class="s">@&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Pick a random index to extract two symbols</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">symbolIndex</span> <span class="o">=</span> <span class="n">arc4random_uniform</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">symbols</span><span class="p">.</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Obtain the two random symbols</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">symbol</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span> <span class="nl">substringWithRange</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="n">symbolIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Obtain random number of each symbols</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">resultString</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableString</span> <span class="nl">stringWithString</span><span class="p">:</span><span class="s">@&quot;&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">n</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">[</span><span class="n">resultString</span> <span class="nl">appendString</span><span class="p">:</span><span class="n">symbol</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">resultString</span> <span class="k">copy</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">generateRandomResult</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSMutableString</span> <span class="o">*</span><span class="n">resultString</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">self</span> <span class="n">generateRandomCharString</span><span class="p">]</span> <span class="n">mutableCopy</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[[</span><span class="n">resultString</span> <span class="nl">stringByAppendingString</span><span class="p">:[</span><span class="nb">self</span> <span class="n">generateRandomCharString</span><span class="p">]]</span> <span class="k">copy</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nf">dataForCellPNGRepresentationForView:</span><span class="p">(</span><span class="bp">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nv">view</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">UIGraphicsBeginImageContext</span><span class="p">(</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span> <span class="nl">renderInContext</span><span class="p">:</span><span class="n">UIGraphicsGetCurrentContext</span><span class="p">()];</span>
</span><span class='line'>    <span class="bp">UIImage</span><span class="o">*</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class='line'>    <span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">UIImagePNGRepresentation</span><span class="p">(</span><span class="n">image1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>generateRandomCharString</strong> - Is used to generate a string of random lenght of a random symbol. As you can see I previously have defined the array of valid symbols which contain no space. A good practice would be to add a test to check that any symbol placed is included in the set of valid symbols.</li>
<li><strong>generateRandomResult</strong> - Is the method used to create a combination of two symbols.</li>
<li><strong>dataForCellPNGRepresentationForView</strong> - Is the method used to obtain a png representation of the view. That is the way we can compare two views at visual level.</li>
</ul>


<p>Now that we have all we need, let&rsquo;s write some tests. I won&rsquo;t go though each test as they are trivial, just list them.</p>

<ul>
<li>Test that on init the background is transparent.</li>
<li>Test that on init the combination value is empty.</li>
<li>Test that when the combination changes bezier path changes.</li>
<li>Test that when the combination is empty bezier paths contains zero circles.</li>
<li>Test that when the combination changes bezier paths contains the same number of circles as the length of the combination.</li>
<li>Test that when the combination has more than two different symbols only first two are stored.</li>
<li>Test that when the combination changes bezier paths contains only bezier paths;</li>
</ul>


<h1>The final method for testing the visual result</h1>

<p>As I commented before, testing against images has some important limitations like depending on the device implementation, small changes makes the test fail, etc &hellip; So, which is the best way to do it? Well nothing better than comparing a view with another view. That way we can be sure there is no difference and we can update easily the implementation.</p>

<p>To do it, you just need to create a view that looks like what you expect your view to look like.</p>

<p>You might think, that is duplicating the effort.</p>

<p>Well, create a dummy view that just does one thing is not duplicating the effort, is prototyping what you expect to obtain and also lets you define some rules that you might translate to your view.</p>

<p>Let&rsquo;s take a look at the dummy view I&rsquo;ve implemented and you&rsquo;ll understand better what I mean.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// Dummy view to draw the image we expect</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DummyView</span> : <span class="bp">UIView</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">combination</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">UIColor</span> <span class="o">*</span><span class="n">color</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DummyView</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">frame</span> <span class="nf">combination:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">combination</span> <span class="nf">color:</span><span class="p">(</span><span class="bp">UIColor</span> <span class="o">*</span><span class="p">)</span><span class="nv">color</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">frame</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">combination</span> <span class="o">=</span> <span class="n">combination</span><span class="p">;</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">;</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">clearColor</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Obtain first char</span>
</span><span class='line'>    <span class="kt">unichar</span> <span class="n">leftchar</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">combination</span> <span class="nl">characterAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">combination</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">combination</span> <span class="nl">stringByReplacingOccurrencesOfString</span><span class="p">:</span><span class="s">@&quot; &quot;</span> <span class="nl">withString</span><span class="p">:</span><span class="s">@&quot;&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">// Obtain rectangle ration</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">K</span> <span class="o">=</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="o">/</span><span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// Obtain number of items</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">N</span> <span class="o">=</span> <span class="n">combination</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Obtain grid sizes</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">verItems</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">sqrtf</span><span class="p">(</span><span class="n">K</span><span class="o">*</span><span class="n">N</span><span class="p">));</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">horItems</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">sqrtf</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="n">K</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Items horizontally</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">gridHeigh</span> <span class="o">=</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">verItems</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">gridWidth</span> <span class="o">=</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">horItems</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Draw circles</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">color</span> <span class="n">setFill</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">color</span> <span class="n">setStroke</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">bezPath</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">currentElement</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">verItems</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">horItems</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">currentElement</span> <span class="o">=</span> <span class="p">(</span><span class="n">horItems</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="n">x</span> <span class="p">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">currentElement</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">bezPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="nl">bezierPathWithOvalInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">gridWidth</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="n">gridHeigh</span><span class="p">,</span> <span class="n">gridWidth</span><span class="p">,</span> <span class="n">gridHeigh</span><span class="p">)];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">([</span><span class="n">combination</span> <span class="nl">characterAtIndex</span><span class="p">:</span><span class="n">currentElement</span><span class="p">]</span> <span class="o">==</span> <span class="n">leftchar</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="p">[</span><span class="n">bezPath</span> <span class="n">fill</span><span class="p">];</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="p">[</span><span class="n">bezPath</span> <span class="n">stroke</span><span class="p">];</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the final implementation of the view, but usually it will grow with your development. Adding new features that you expect to find in your view. And more important, will protect you from changing what you expect to see if you make any change in your code in the future.</p>

<p>With that in mind, the tests become a lot more clear.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testIfNewResultHasOnlyOneSymbolByDefaultAreFirstSymbol</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">resultCell</span><span class="p">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">generateRandomCharString</span><span class="p">];</span>
</span><span class='line'>    <span class="n">resultCell</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DummyView</span> <span class="o">*</span><span class="n">dummyV</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DummyView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">resultCell</span><span class="p">.</span><span class="n">frame</span>
</span><span class='line'>                                             <span class="nl">combination</span><span class="p">:</span><span class="n">resultCell</span><span class="p">.</span><span class="n">result</span>
</span><span class='line'>                                                   <span class="nl">color</span><span class="p">:</span><span class="n">resultCell</span><span class="p">.</span><span class="n">color</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSData</span> <span class="o">*</span><span class="n">expectedImage</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">dataForCellPNGRepresentationForView</span><span class="p">:</span><span class="n">dummyV</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSData</span> <span class="o">*</span><span class="n">obtainedImage</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">dataForCellPNGRepresentationForView</span><span class="p">:</span><span class="n">resultCell</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">XCTAssertEqualObjects</span><span class="p">(</span><span class="n">expectedImage</span><span class="p">,</span> <span class="n">obtainedImage</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Create our view.</li>
<li>Create a dummy view with the same parameters.</li>
<li>Extract the representing images.</li>
<li>Check both match.</li>
</ol>


<p>Take a look at the rest of the test, I think they are pretty clear, but if you believe there is something you can&rsquo;t see, just send me an email or leave me a comment.</p>

<p>And with this post I finish with the TDD by now and we can start with the BDD.</p>

<p>Please, leave me comments, share and like if you can! See you in the next post.</p>
</div>


  <footer>
    <p class="meta">
      
  



  <span class="byline author vcard">Authored by <span class="fn">
  
    Guillem Fernandez
  
  </span></span>


      




<time class='entry-date' datetime='2014-11-10T13:25:00+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:25 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bdd/'>bdd</a>, <a class='category' href='/blog/categories/development/'>development</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.guillem.mobi/blog/2014/11/10/bdd-mastermind-view-preparation/" data-via="guillemfg" data-counturl="http://blog.guillem.mobi/blog/2014/11/10/bdd-mastermind-view-preparation/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-layout="button_count" data-send="false" data-width="300" data-show-faces="false"></div>
  
  
    <script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
	</script>
  	<script type="IN/Share" data-counter="right"></script>
  
 </div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/10/21/bdd-mastermind-view-preparation-to-make-the-ui-testable/" title="Previous Post: BDD - Mastermind : View preparation to make the UI testable">&laquo; BDD - Mastermind : View preparation to make the UI testable</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/11/20/bdd-mastermind-adding-calabash-and-creating-our-first-tests/" title="Next Post: BDD - Mastermind : Adding calabash and creating our first tests">BDD - Mastermind : Adding calabash and creating our first tests &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Guillem Fernandez -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'guillemfernandez';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.guillem.mobi/blog/2014/11/10/bdd-mastermind-view-preparation/';
        var disqus_url = 'http://blog.guillem.mobi/blog/2014/11/10/bdd-mastermind-view-preparation/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
