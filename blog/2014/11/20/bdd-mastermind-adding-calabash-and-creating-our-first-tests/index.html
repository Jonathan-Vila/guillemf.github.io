
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>BDD - Mastermind : Adding Calabash and Creating Our First Tests - Guillem Fernandez</title>
  <meta name="author" content="Guillem Fernandez">

  
  <meta name="description" content="This is the sixth post to create an application using BDD and TDD in iOS. If you missed the previous post, my recommendation is that you read it &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://guillemf.github.io/blog/2014/11/20/bdd-mastermind-adding-calabash-and-creating-our-first-tests">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Guillem Fernandez" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52623021-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><img src="/images/Logo64.png" height="64" width="64"/ id="header-logo"><a href="/">Guillem Fernandez</a></h1>
  
    <h2>About my job and my passion.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
  
  
<ul class="subscription">
  <li><a href="http://delicious.com/guillemf" rel="subscribe-delicious" title="Delicious Bookmarks">Delicious</a></li>
</ul>
  
  
  
<ul class="subscription">
  <li><a href="https://github.com/guillemf" rel="subscribe-github" title="@guillemf on GitHub">GitHub</a></li>
</ul>
  
  
  
<ul class="subscription">
  <li><a href="https://bitbucket.org/guillemfg" rel="subscribe-bitbucket" title="@guillemfg on Bitbucket">Bitbucket</a></li>
</ul>
  
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:guillemf.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/profile">About</a></li>
  <li><a href="/porfolio">Porfolio</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">BDD - Mastermind : Adding Calabash and Creating Our First Tests</h1>
      
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-20T20:06:16+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:06 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>This is the sixth post to create an application using BDD and TDD in iOS. If you missed the previous post, my recommendation is that you read it first <a href="/blog/2014/11/10/bdd-mastermind-view-preparation/" title="BDD - Mastermind : View preparation">here</a>. If you just landed, better start on the <a href="/blog/2014/08/20/bdd-from-the-idea-to-the-app-2/" title="BDD: From the Idea to the App 2">first</a></p>

<p>In this post is where we really start doing BDD, so get ready to enter to the new and exciting world of cucumber and behaviour driven development.</p>

<!-- more -->


<h1>Cucumber, What is it and How to use</h1>

<p>In previous post I&rsquo;ve introduced the concept of cucumber, and in this post we are going to start with it. But first I&rsquo;d like to give you a brief introduction about cucumber and what is it.</p>

<p>Cucumber is an set of tools that allows us to write tests in &ldquo;<em>natural language</em>&rdquo; that are readable by the computer and tell it what to test and how to test. Notice that I&rsquo;ve written &ldquo;<em>natural language</em>&rdquo; between quotes and in italics. That is because we should make a couple precissions here. First, the language is natural because it can be read as a natural language written story, but is not so natural in the sense that we can&rsquo;t write it as it comes, but we have to follow some conventions that describe the gherkin syntax. Second, the test, as said before, are not going to work out of the box. Eventhough there are some steps that work with no additional effort, most of the steps will need a definition from your side.</p>

<p>You could say - &ldquo;<em>what&rsquo;s the point in writting the tests if we have to do another development job behind?</em>&rdquo;</p>

<p>Well, the advantage you get from this is the ability to have clearer tests that can be mantained with lot less effort and that can be written, read and maintained by third party and non technical people.</p>

<h1>Back to school, let&rsquo;s learn some syntax</h1>

<p>A good definition of what is gerkhin is in <a href="https://pragprog.com/book/hwcuc/the-cucumber-book" title="The Pragmatic Bookshelf">The Cucumber Book: Behaviour-Driven Development for Testes and Developers</a>, an excellent book that I highly recomend you to read if you want to be a &ldquo;<em>Cucumber Master</em>&rdquo;.</p>

<blockquote><p>&ldquo;<em>Gherkin gives us a lightweight structure for documenting examples of the behavior our stakeholders want, in a way that it can be easily understood both by the stakeholders and by Cucumber.</em>&rdquo;</p></blockquote>

<p>Let&rsquo;s see an example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Feature:</span><span class="nf"> Board behaviour</span>
</span><span class='line'><span class="nf">  As a Player</span>
</span><span class='line'><span class="nf">  I want to see how the cells react to my taps as expected</span>
</span><span class='line'><span class="nf">  So I can begin playing</span>
</span><span class='line'>
</span><span class='line'><span class="k">Scenario:</span><span class="nf"> Initial situation</span>
</span><span class='line'><span class="k">  Given </span><span class="nf">I am on the Initial Screen</span>
</span><span class='line'><span class="nf">  </span><span class="k">Then </span><span class="nf">a new game should be ready</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see this peace of code is written in a way anyone could understand, well, anyone who speaks english. What about a non english speaker stake holder? Well, gherkin syntax can be written in 40 different languages. You can see a list of available languages by running cucumber gem as &lsquo;<em>cucumber &ndash;i18n help</em>&rsquo; and you&rsquo;ll be listed all available languages. At this moment, this is what my system shows.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='vctreestatus'><span class='line'>      | ar        | Arabic              | العربية           |
</span><span class='line'>      | bg        | Bulgarian           | български         |
</span><span class='line'>      | bm        | Malay               | Bahasa Melayu     |
</span><span class='line'>      | ca        | Catalan             | català            |
</span><span class='line'>      | cs        | Czech               | Česky             |
</span><span class='line'>      | cy-GB     | Welsh               | Cymraeg           |
</span><span class='line'>      | da        | Danish              | dansk             |
</span><span class='line'>      | de        | German              | Deutsch           |
</span><span class='line'>      | el        | Greek               | Ελληνικά          |
</span><span class='line'>      | en        | English             | English           |
</span><span class='line'>      | en-Scouse | Scouse              | Scouse            |
</span><span class='line'>      | en-au     | Australian          | Australian        |
</span><span class='line'>      | en-lol    | LOLCAT              | LOLCAT            |
</span><span class='line'>      | en-old    | Old English         | Englisc           |
</span><span class='line'>      | en-pirate | Pirate              | Pirate            |
</span><span class='line'>      | en-tx     | Texan               | Texan             |
</span><span class='line'>      | eo        | Esperanto           | Esperanto         |
</span><span class='line'>      | es        | Spanish             | español           |
</span><span class='line'>      | et        | Estonian            | eesti keel        |
</span><span class='line'>      | fa        | Persian             | فارسی             |
</span><span class='line'>      | fi        | Finnish             | suomi             |
</span><span class='line'>      | fr        | French              | français          |
</span><span class='line'>      | gl        | Galician            | galego            |
</span><span class='line'>      | he        | Hebrew              | עברית             |
</span><span class='line'>      | hi        | Hindi               | हिंदी               |
</span><span class='line'>      | hr        | Croatian            | hrvatski          |
</span><span class='line'>      | hu        | Hungarian           | magyar            |
</span><span class='line'>      | id        | Indonesian          | Bahasa Indonesia  |
</span><span class='line'>      | is        | Icelandic           | Íslenska          |
</span><span class='line'>      | it        | Italian             | italiano          |
</span><span class='line'>      | ja        | Japanese            | 日本語             |
</span><span class='line'>      | kn        | Kannada             | ಕನ್ನಡ              |
</span><span class='line'>      | ko        | Korean              | 한국어             |
</span><span class='line'>      | lt        | Lithuanian          | lietuvių kalba    |
</span><span class='line'>      | lu        | Luxemburgish        | Lëtzebuergesch    |
</span><span class='line'>      | lv        | Latvian             | latviešu          |
</span><span class='line'>      | nl        | Dutch               | Nederlands        |
</span><span class='line'>      | no        | Norwegian           | norsk             |
</span><span class='line'>      | pa        | Panjabi             | ਪੰਜਾਬੀ              |
</span><span class='line'>      | pl        | Polish              | polski            |
</span><span class='line'>      | pt        | Portuguese          | português         |
</span><span class='line'>      | ro        | Romanian            | română            |
</span><span class='line'>      | ru        | Russian             | русский           |
</span><span class='line'>      | sk        | Slovak              | Slovensky         |
</span><span class='line'>      | sr-Cyrl   | Serbian             | Српски            |
</span><span class='line'>      | sr-Latn   | Serbian (Latin)     | Srpski (Latinica) |
</span><span class='line'>      | sv        | Swedish             | Svenska           |
</span><span class='line'>      | th        | Thai                | ไทย               |
</span><span class='line'>      | tl        | Telugu              | తెలుగు             |
</span><span class='line'>      | tr        | Turkish             | Türkçe            |
</span><span class='line'>      | tt        | Tatar               | Татарча           |
</span><span class='line'>      | uk        | Ukrainian           | Українська        |
</span><span class='line'>      | uz        | Uzbek               | Узбекча           |
</span><span class='line'>      | vi        | Vietnamese          | Tiếng Việt        |
</span><span class='line'>      | zh-CN     | Chinese simplified  | 简体中文           |
</span><span class='line'>      | zh-TW     | Chinese traditional | 繁體中文           |
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>So we could write the same peace of code we wrote before as.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Característica:</span><span class="nf"> Comportamiento del Tablero</span>
</span><span class='line'><span class="nf">  Como jugador</span>
</span><span class='line'><span class="nf">  Quiero saber como reaccionan las celdas a mis pulsaciones tal como esper</span>
</span><span class='line'><span class="nf">  y así poder empezar a jugar</span>
</span><span class='line'>
</span><span class='line'><span class="k">Escenario:</span><span class="nf"> Situación inicial</span>
</span><span class='line'><span class="k">  Dado </span><span class="nf">que estoy en la pantalla inicial</span>
</span><span class='line'><span class="nf">  </span><span class="k">Entonces </span><span class="nf">un nuevo juego debería estar listo</span>
</span></code></pre></td></tr></table></div></figure>


<p>And cucumber should be able to proceed the same way as when it was written in english. Of course the steps definitions won&rsquo;t be called the same or will do any translation, but we can map them.</p>

<p>Gherkin is basically a set of keywords organised in a certain way and followed by sentences that might or might not contain parameters and have to be defined as steps.</p>

<p>The keywords used by gherkin are:</p>

<ul>
<li>First level

<ul>
<li>Feature</li>
<li>Background</li>
<li>Scenario</li>
</ul>
</li>
<li>Second level

<ul>
<li>Given</li>
<li>When</li>
<li>Then</li>
<li>And</li>
<li>But</li>
<li>*</li>
<li>Scenario Outline</li>
<li>Examples</li>
</ul>
</li>
</ul>


<p>First level keywords are used to separate different tests and group them, while the second level ones are to define each step or provide data to test on. I won&rsquo;t go deeper on this as it is not the purpose of this port serie. As I commented before, if you really want to get more information go and buy the book <a href="https://pragprog.com/book/hwcuc/the-cucumber-book" title="The Pragmatic Bookshelf">The Cucumber Book: Behaviour-Driven Development for Testes and Developers</a>, it&rsquo;s at the high level Pragmatic Programmers always offer.</p>

<h1>Talk is cheap. Show me the code</h1>

<p>It all looks very nice, but, does it work? And how does that work?</p>

<p>Well, let&rsquo;s start by writting our first feature.</p>

<p>If you remember a previous post in this series called <a href="/blog/2014/09/25/bdd-mastermind-internal-design/" title="Previous post reference">BDD - Mastermind : Internal Design</a>, I defined there the acceptance criterias the way a stakeholder would define them ( more or less, that&rsquo;s my humble contribution ). Let&rsquo;s bring it back to write a couple of them in gherkin.</p>

<ul>
<li>The screen should contain nine rows and five columns.</li>
<li>The left most column has to be gray.</li>
<li>The other five columns has to be white.</li>
<li>When I first open the app, a new game should be ready.</li>
<li>When a new game starts, the screen should contain no colors and no results.</li>
</ul>


<p>As you can imagine there are many ways to write those acceptance criterias in gherkin. The one I choosed is the following one.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> Initial situation</span>
</span><span class='line'><span class="k">  Given </span><span class="nf">I am on the Initial Screen</span>
</span><span class='line'><span class="nf">  </span><span class="k">Then </span><span class="nf">a new game should be ready</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you might deduct, the step &ldquo;<em>Given I am on the Initial Screen</em>&rdquo; includes</p>

<ul>
<li>The screen should contain nine rows and five columns.</li>
<li>The left most column has to be gray.</li>
<li>The other five columns has to be white.</li>
</ul>


<p>There are, at least, two ways we can do it. Creating one step for each condition and then putting them all together in a single step called &ldquo;Given I am on the Initial Screen&rdquo; or creating all steps into the &ldquo;Given I am on the Initial Screen&rdquo;.</p>

<p>I decided to go this second way, but it would be a good practice if you try to do it the other way and see how it works the same way or even better.</p>

<p>So let&rsquo;s dive into the definition of the steps.</p>

<p>First of all, go to your project folder, be sure you are in the same folder as your .xcproject and then run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='vctreestatus'><span class='line'>$ gem install calabash-cucumber
</span><span class='line'>
</span><span class='line'>$ calabash-ios setup
</span><span class='line'>Checking if Xcode is running...
</span></code></pre></td></tr></table></div></figure>


<p>When it is finished, open the new created .xcworkspace file and build the new target you have ending in -cal . You need to do it because cucumber needs a binary to run the tests on, otherwise you are going to start having complains from cucumber.</p>

<p>In the project folder you&rsquo;ll see a new folder called features, that&rsquo;s where all cucumber magic lives.</p>

<p>When you open the .feature file and replace the default feature for your new feature and you run cucumber, this is what you are going to see:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='vctreestatus'><span class='line'>╰─$ DEVICE_TARGET=&#39;iPhone 6 (8.1 Simulator)&#39; cucumber
</span><span class='line'>Feature: Board behaviour
</span><span class='line'>  As a Player
</span><span class='line'>  I want to see how the cells react to my taps as expected
</span><span class='line'>  So I can begin playing
</span><span class='line'>
</span><span class='line'>  Scenario: Initial situation        # features/start.feature:6
</span><span class='line'>    Given I am on the Initial Screen # features/start.feature:7
</span><span class='line'>    Then a new game should be ready  # features/start.feature:8
</span><span class='line'>
</span><span class='line'>1 scenario (1 undefined)
</span><span class='line'>2 steps (2 undefined)
</span><span class='line'>0m15.800s
</span><span class='line'>
</span><span class='line'>You can implement step definitions for undefined steps with these snippets:
</span><span class='line'>
</span><span class='line'>Given(/^I am on the Initial Screen$/) do
</span><span class='line'>  pending # express the regexp above with the code you wish you had
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>Then(/^a new game should be ready$/) do
</span><span class='line'>  pending # express the regexp above with the code you wish you had
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note that the command used to run the test &lsquo;<em>DEVICE_TARGET=&#8217;iPhone 6 (8.1 Simulator)&rsquo; cucumber</em>&lsquo;. Please take a look at <a href="https://github.com/calabash/calabash-ios/wiki" title="Documentation fo Calabash">calabash documentation</a> for more options.</p></blockquote>

<p>You can see how cucumber helps us.</p>

<blockquote><p>You can implement step definitions for undefined steps with these snippets:</p>

<p>Given(/^I am on the Initial Screen$/) do
  pending # express the regexp above with the code you wish you had
end</p>

<p>Then(/^a new game should be ready$/) do
  pending # express the regexp above with the code you wish you had
end</p></blockquote>

<p>Those are the steps you need to implement inside your features/step_definitions/mastermind_steps.rb file. Let&rsquo;s take a look on how I&rsquo;ve defined them.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^I am on the Initial Screen$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># The screen should contain nine rows and five columns</span>
</span><span class='line'>  <span class="n">rows</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s2">&quot;view {accessibilityLabel BEGINSWITH &#39;Combination Row&#39;}&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;The screen should contain nine rows&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">rows</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">9</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Following the mock, those rows have to be as wide as the screen</span>
</span><span class='line'>  <span class="n">window</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s2">&quot;window&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">rows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;width&quot;</span><span class="o">]</span> <span class="o">!=</span> <span class="n">window</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;width&quot;</span><span class="o">]</span>
</span><span class='line'>       <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;All rows have to be as wide as the screen&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="c1"># Following the mock, the rows have distributed along the screen  </span>
</span><span class='line'>  <span class="n">lastFloor</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">rows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;y&quot;</span><span class="o">]</span> <span class="o">!=</span> <span class="n">lastFloor</span>
</span><span class='line'>       <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Each row has to be after the previous one, expecting </span><span class="si">#{</span><span class="n">lastFloor</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;y&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> found&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;All rows should be higher than zero&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;height&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">lastFloor</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;y&quot;</span><span class="o">]</span> <span class="o">+</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;frame&quot;</span><span class="o">][</span><span class="s2">&quot;height&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># All rows are combination</span>
</span><span class='line'>  <span class="n">rows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;All rows must be combination rows but </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="s2">&quot;class&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> was found&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;class&quot;</span><span class="o">]</span> <span class="o">!=</span> <span class="s2">&quot;MMCombinationRow&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="no">STEP_PAUSE</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span><span class="p">(</span><span class="sr">/^a new game should be ready$/</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">rows</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s2">&quot;view {accessibilityLabel BEGINSWITH &#39;Combination Row&#39;}&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">rows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">combination</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="s2">&quot;label&quot;</span><span class="o">][</span><span class="mi">18</span><span class="o">.</span><span class="n">.</span><span class="mi">23</span><span class="o">]</span>
</span><span class='line'>    <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;All rows combinations must be empty but </span><span class="si">#{</span><span class="n">combination</span><span class="si">}</span><span class="s2"> was found&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">combination</span> <span class="o">!=</span> <span class="s2">&quot;&#39;    &#39;&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To match one buy one the acceptance criterias with the steps let&rsquo;s split it.</p>

<ul>
<li>The screen should contain nine rows and five columns.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># The screen should contain nine rows and five columns</span>
</span><span class='line'>  <span class="n">rows</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s2">&quot;view {accessibilityLabel BEGINSWITH &#39;Combination Row&#39;}&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;The screen should contain nine rows&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">rows</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">9</span>
</span></code></pre></td></tr></table></div></figure>


<p>Previoulsy to this step, you can find a new class in the code called <em>MMCombinationRow</em> that has been created with TDD and ensures containing five cells, one result cell and four color cells. So what&rsquo;s missing here is the number of rows.</p>

<p>Another way to implement this check is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># The screen should contain nine rows and five columns</span>
</span><span class='line'>  <span class="n">rows</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s2">&quot;MMCombinationRow&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;The screen should contain nine rows&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">rows</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">9</span>
</span></code></pre></td></tr></table></div></figure>


<p>Go and implement the rest and see how it fails and what have you got to change to make it pass and then go and run the unit tests to ensure you didn&rsquo;t break anything.</p>

<p>If all goes fine, just making a <em>git checkout</em> of <a href="https://github.com/guillemf/Mastermind-BDD/tree/Step_7" title="MasterMind-BDD Step7">Step 7</a> and you should see something like this:</p>

<div class="embed-video-container"><iframe src="//www.youtube.com/embed/RYihMe_5yws" allowfullscreen></iframe></div>


<p>Remember you can find the code of this post in <a href="https://github.com/guillemf/Mastermind-BDD/tree/Step_8" title="MasterMind-BDD Step5">this commit, Step 8</a>.</p>

<p>If you like it, please share! Thank you for reading me.</p>
</div>


  <footer>
    <p class="meta">
      
  



  <span class="byline author vcard">Authored by <span class="fn">
  
    Guillem Fernandez
  
  </span></span>


      




<time class='entry-date' datetime='2014-11-20T20:06:16+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:06 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bdd/'>bdd</a>, <a class='category' href='/blog/categories/development/'>development</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://guillemf.github.io/blog/2014/11/20/bdd-mastermind-adding-calabash-and-creating-our-first-tests/" data-via="guillemfg" data-counturl="http://guillemf.github.io/blog/2014/11/20/bdd-mastermind-adding-calabash-and-creating-our-first-tests/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-layout="button_count" data-send="false" data-width="300" data-show-faces="false"></div>
  
  
    <script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
	</script>
  	<script type="IN/Share" data-counter="right"></script>
  
 </div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/11/10/bdd-mastermind-view-preparation/" title="Previous Post: BDD - Mastermind : View preparation">&laquo; BDD - Mastermind : View preparation</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/01/20/ios-7-and-ios-8-living-together/" title="Next Post: iOS 7 and iOS 8 living together">iOS 7 and iOS 8 living together &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Guillem Fernandez -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'guillemfernandez';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://guillemf.github.io/blog/2014/11/20/bdd-mastermind-adding-calabash-and-creating-our-first-tests/';
        var disqus_url = 'http://guillemf.github.io/blog/2014/11/20/bdd-mastermind-adding-calabash-and-creating-our-first-tests/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
